<dui-screen>
  <dui-screen-content class="row">

    <dui-box class="col-md-12">
      <dui-box-content>

        <div class="panel panel-default">
          <div class="panel-heading">
            Items
            <span class="pull-right">
              <a href="#" ui-sref="app.add" class="btn btn-default btn-xs">+</a>
            </span>
          </div>
          <div class="panel-body">
            <table st-table="ctrl.items" class="table table-bordered table-striped">
              <tr>
                <th cs-select-all="ctrl.items" class="st-checkbox">&nbsp;</th>
                <th class="col-md-6" st-sort='name'>Name</th>
                <th class="col-md-2">Status</th>
                <th class="col-md-2">Person</th>
                <th class="col-md-2">Created</th>
              </tr>
              <tr ng-repeat="item in ctrl.items">
                <td cs-select="item"></td>
                <td>
                  <a href="#" ui-sref="app.edit({itemId: item.id})">
                    {{item.name}}
                  </a>
                  <span class="pull-right" ng-repeat="tag in item.tags">
                    <span class="badge">{{tag.name}}</span>&nbsp;
                  </span>
                </td>
                <td>
                  {{item.status}}
                </td>
                <td>
                  {{item.person.name}}
                </td>
                <td class="text-nowrap">
                  {{item.created | date: 'medium'}}
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-footer">
            <select
              ng-model="ctrl.batchOperation"
              ng-options="item.value as item.label for item in ctrl.batchOperations">

            </select>
            <a ng-click="ctrl.applyBatchOperation()" class="btn btn-default btn-xs">Apply</a>

            <button class="btn btn-default btn-xs" ng-click="ctrl.modalExport()">Export</button>

          </div>
        </div>

      </dui-box-content>
    </dui-box>

    <dui-box class="col-md-6" ng-show="false">
      <dui-box-content>
        <pre>{{ctrl.items|json}}</pre>
      </dui-box-content>
    </dui-box>

    <dui-box class="col-md-6" ng-show="false">
      <dui-box-content>
        <pre>{{ctrl.batchOperation|json}}</pre>
        <pre>{{ctrl.itemsSelected.length}} items selected</pre>
        <pre>{{ctrl.itemsSelected|json}}</pre>
      </dui-box-content>
    </dui-box>


  </dui-screen-content>
</dui-screen>

<script type="text/ng-template" id="modalExport.html">
  <div class="modal-header">
    <h3 class="modal-title">Export to CSV</h3>
  </div>
  <div class="modal-body">
    <form>
      <div class="form-group">
        <label>Export options</label>

        <div class="checkbox">
          <label class="checkbox">
            <input type="checkbox" ng-model="ctrl.export.headers"> Export with headers
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="exportFilename">Filename</label>
        <input id="exportFilename" type="text" class="form-control" ng-model="ctrl.export.filename">
      </div>
      <div class="form-group">
        <label>Fields</label>

        <div class="checkbox" ng-repeat="field in ctrl.export.fields">
          <label class="checkbox">
            <input type="checkbox" ng-model="field.selected"> {{field.label}}
            <small class="text-muted">{{field.name}}</small>
          </label>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary"
            ng-csv="ctrl.exportCsv()"
            field-separator=";"
            filename="{{ctrl.export.filename}}">Export
    </button>
    <button class="btn btn-default" ng-click="ctrl.cancel()">Cancel</button>
  </div>
</script>
